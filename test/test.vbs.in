' run with cscript
if InStr(LCase(WScript.FullName),"cscript")=0 Then
	WScript.Echo("Please run:  cscript /nologo configure.vbs")
	WScript.Quit
end if

db=WScript.Arguments(0)

if db="" then
	WScript.Echo("usage: test database")
	WScript.Quit
end if

' create file system object
set fso=CreateObject("Scripting.FileSystemObject")

' create shell object
set WshShell=WScript.CreateObject("WScript.Shell")

for each api in Array(@TESTAPIS@)
	if runtest(api)=false then
		exit for
	end if
next

function runtest(api)

	retval=true

	WScript.echo("testing in " & api)
	WScript.echo("")
	WshShell.CurrentDirectory=api 

	TEST=""
	TESTFILE=""
	select case api
		case "c"
			TEST=db & ".exe"
			TESTFILE=db & ".exe"
		case "c++"
			TEST=db & ".exe"
			TESTFILE=db & ".exe"
		case "cs"
			TEST=db & ".exe"
			TESTFILE=db & ".exe"
		case "java"
			TEST="run.bat " & db
			TESTFILE=db & ".class"
		case "nodejs"
			TEST="node " & db & ".js"
			TESTFILE=db & ".js"
		case "perl"
			TEST="perl " & db & ".pl"
			TESTFILE=db & ".pl"
		case "perldbi"
			TEST="perl " & db & ".pl"
			TESTFILE=db & ".pl"
		case "php"
			TEST="php " & db & ".php"
			TESTFILE=db & ".php"
		case "phppdo"
			TEST="php " & db & ".php"
			TESTFILE=db & ".php"
		case "python"
			TEST="python " & db & ".py"
			TESTFILE=db & ".py"
		case "pythondb"
			TEST="python " & db & ".py"
			TESTFILE=db & ".py"
		case "ruby"
			TEST="ruby " & db & ".rb"
			TESTFILE=db & ".rb"
		case "tcl"
			TEST="tclsh " & db & ".tcl"
			TESTFILE=db & ".tcl"
	end select

	if fso.FileExists(TESTFILE) then
		set cmd=WshShell.Exec(TEST)
		do until cmd.StdOut.AtEndOfStream
			WScript.Echo(cmd.StdOut.ReadLine())
		loop
		if cmd.ExitCode=1 then
			WScript.echo("")
			WScript.echo("")
			WScript.echo(db & " failed in " & api)
			WScript.StdIn.ReadLine()
			retval=false
		else
			WScript.echo("")
			WScript.echo("test complete")
		end if
	else
		WScript.echo("no test found for " & db & " in " & api)
	end if

	WScript.echo("")
	WScript.echo("================================================================================")
	WScript.echo("")

	WshShell.CurrentDirectory=".."

	runtest=retval
end function
