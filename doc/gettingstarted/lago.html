<html>

<head>
<title>SQL Relay - Getting Started With Lago</title>
<link rel="stylesheet" href="../css/styles.css">
</head>

<body>

<span class="heading1">Getting Started With Lago</span><br>

<ul>
<li><a href="#installation">Installation</a></li>
<ul>
<li><a href="#startingatboot">Starting the Database at Boot Time</a></li>
</ul>
<li><a href="#creating">Creating a Database</a></li>
<li><a href="#accessing">Accessing a Database</a></li>
<li><a href="#sqlrelay">Accessing a Database With SQL Relay</a></li>
</ul>

<a name="installation"></a>
<span class="heading1">Installation</span><br>

<p>I've sucessfully installed lago on Linux, FreeBSD, SCO OpenServer and 
Solaris.  On all platforms, I've had to compile it from source.  I've gotten it 
to compile on OpenBSD and NetBSD, but never got it to run correctly.  Lago is 
available from the 
<a href="http://lago.sourceforge.net">Lago home page</a>.  For NetBSD and 
OpenBSD you need the version that comes with it's own pthreads 
implementation.</p>

<p>Lago will not successfully compile with gcc 2.96 or 3.0.  You'll have to use
gcc 2.95.</p>

<p>If your distribution does not come with gcc 2.95, you can download it from 
<a href="ftp://ftp.gnu.org/pub/gcc">the GNU ftp site</a> and compile it.  I 
usually give the gcc <i>configure</i> script the 
<i>--prefix=/usr/local/gnu-2.95</i> parameter so that gcc will be installed 
under /usr/local/gcc-2.95.  Then, when building lago, I add 
/usr/local/gcc-2.95 to the beginning of my PATH environment variable so that it
will be used during the build.</p>

<p>To build and install lago, you should create a lago user, assign it a 
password then build and install the software as that user.  I usually give the 
lago <i>configure</i> script the <i>--prefix=/usr/local/lago</i> parameter so 
that Lago will be installed under /usr/local/lago.  I then add 
/usr/local/lago/bin to my PATH environment variable and /usr/local/lago/lib to 
my LD_LIBRARY_PATH environment variable.</p>

<p>On some platforms lago requires a modification to compile.  If compilation
fails with an error in scktcman.xx, change line 146 of 
lago/conn/scktcman.cxx from</p>

<blockquote>
fd = accept(listener, (struct sockaddr *)&amp;addr, &amp;size);
</blockquote>

<p>to</p>

<blockquote>
fd = accept(listener, (struct sockaddr *)&amp;addr, (socklen_t *)&amp;size);
</blockquote>

<p>On some platforms lago requires a different modification.  The files
lago/querydef/qd_expr.h, lago/executor/exc_expr.cxx and 
lago/querydef/qd_dump.cxx refer to variables named "not".  Some compilers don't
like this.  If you get an errors in those files, change the variable to __not 
wherever it appears.</p>

<p>Once the software is installed, run the following command.</p>

<blockquote>
<b>/usr/local/lago/bin/lago --bootstrap</b>
</blockquote>

<p>This command creates a SYS database with a special administrative user named
lago and prompts you for a password for that user.</p>

<a name="startingatboot"></a>
<span class="heading2">Starting the Database at Boot Time</span><br>

<p>You can use the following scrip to start/stop the database at boot/shutdown
time.</p>

<blockquote>
<PRE>
<FONT color=#0000ff>#!/bin/sh</FONT>

<B><FONT color=#a62828>case</FONT></B> &quot;$1&quot; <B><FONT color=#a62828>in</FONT></B>
        start<B><FONT color=#a62828>)</FONT></B>
                /usr/local/lago/bin/lago <B><FONT color=#a62828>&gt;</FONT></B> /dev/null <B><FONT color=#a62828>&amp;</FONT></B>
                <B><FONT color=#a62828>;;</FONT></B>
        stop<B><FONT color=#a62828>)</FONT></B>
                <B><FONT color=#a62828>kill</FONT></B> <FONT color=#6959cf>`ps </FONT><FONT color=#6959cf>-efa</FONT><FONT color=#6959cf> </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> grep lago </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> grep </FONT><FONT color=#6959cf>-v</FONT><FONT color=#6959cf> grep </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> awk </FONT><B><FONT color=#a62828>'</FONT></B><FONT color=#ff00ff>{print $2}</FONT><B><FONT color=#a62828>'</FONT></B><FONT color=#6959cf>`</FONT>
                <B><FONT color=#a62828>;;</FONT></B>
        *<B><FONT color=#a62828>)</FONT></B>
                <B><FONT color=#a62828>echo</FONT></B><FONT color=#ff00ff> $</FONT><B><FONT color=#a62828>&quot;</FONT></B><FONT color=#ff00ff>Usage: </FONT><FONT color=#a620f7>$0</FONT><FONT color=#ff00ff> {start|stop}</FONT><B><FONT color=#a62828>&quot;</FONT></B>
                <B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>1</FONT>
<B><FONT color=#a62828>esac</FONT></B>

<B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>0</FONT>
</PRE>
</blockquote>

<p>Install this script and run it with the "start" option to start up the
database.  Running it with the "stop" option shuts the database down.  To
access a database, it must be running.</p>

<a name="creating"></a>
<span class="heading1">Creating a Database</span><br>

<p>To use lago, you should create a database separate from the special SYS
database.  To do this, log into the SYS database as the lago user.</p>

<blockquote>
<b>lsql -u lago -d SYS -p</b>
</blockquote>

<p>To create a database named <i>testdb</i>, run the following query.</p>

<blockquote>
<PRE>
<B><FONT color=#a62828>CREATE</FONT></B> DATABASE testdb <FONT color=#6959cf>FILE</FONT> <FONT color=#ff00ff>'/usr/local/lago/data/testdb.lgo'</FONT> <FONT color=#6959cf>SIZE</FONT> <FONT color=#ff00ff>20</FONT>;
</PRE>
</blockquote>

<p>To create a user named <i>testuser</i>, run the following command.
The command will prompt you for a password and Reader/Writer/Administrator
permissions.  Make the user a Writer.</p>

<blockquote>
<b>\U testuser</b>
</blockquote>

<p>You can log out of the SYS database with the \q command.  The new user
should have access to the new database you created.</p>

<p>This should be enough to get you started.  To set up more complex
configurations, consult the Lago
<a href="http://lago.sourceforge.net/doc/user/index.html">online 
documentation</a>.</p>

<a name="installation"></a>
<span class="heading1">Accessing a Database</span><br>

<p>Accessing a Lago database using the lsql client tool is simple.  For
example, to access a database called <i>testdb</i> on the local machine as
the <i>testuser</i> user, use the following command.  You will be prompted
for a password.</p>

<blockquote>
<b>lsql -u testuser -d testdb -p</b>
</blockquote>

<p>Once you're connected to the database, the lsql client prompts you to
enter a query.  Queries may be split across multiple lines.  To run a query, 
end it with a semicolon.  To exit, type \q.</p>

<p>A sample lsql session follows.</p>

<blockquote>
<PRE>
[user@localhost user]$ lsql -u testuser -d testdb -p
LSQL version <FONT color=#ff00ff>0.5</FONT>.<FONT color=#ff00ff>2</FONT>, Copyright <FONT color=#ff00ff>1999</FONT>, <FONT color=#ff00ff>2000</FONT> by Emanuele Fornara
LSQL comes with ABSOLUTELY NO WARRANTY; type <FONT color=#ff00ff>'\l'</FONT> for details and <FONT color=#ff00ff>'\?'</FONT> for help
password: 
testdb&gt; <B><FONT color=#a62828>create</FONT></B> <FONT color=#6959cf>table</FONT> testtable (
     <FONT color=#ff00ff>2</FONT>&gt; col1 <B><FONT color=#288a51>char</FONT></B>(<FONT color=#ff00ff>40</FONT>),
     <FONT color=#ff00ff>3</FONT>&gt; col2 <B><FONT color=#288a51>integer</FONT></B> 
     <FONT color=#ff00ff>4</FONT>&gt; );
testdb&gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> tables;
+<FONT color=#0000ff>-----------+--------------------------------+-----------+-----------+</FONT>
| TABLE_ID  |              NAME              | FIRSTPAGE | LASTPAGE  |
+<FONT color=#0000ff>-----------+--------------------------------+-----------+-----------+</FONT>
|          <FONT color=#ff00ff>1</FONT>|TABLES                          |          <FONT color=#ff00ff>1</FONT>|          <FONT color=#ff00ff>1</FONT>|
|          <FONT color=#ff00ff>2</FONT>|COLUMNS                         |          <FONT color=#ff00ff>2</FONT>|          <FONT color=#ff00ff>2</FONT>|
|          <FONT color=#ff00ff>3</FONT>|testtable                       |          <FONT color=#ff00ff>3</FONT>|          <FONT color=#ff00ff>3</FONT>|
+<FONT color=#0000ff>-----------+--------------------------------+-----------+-----------+</FONT>
<FONT color=#ff00ff>3</FONT> rows returned
testdb&gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> columns <FONT color=#6959cf>where</FONT> table_id=<FONT color=#ff00ff>3</FONT>;
+<FONT color=#0000ff>-----------+-----------+--------------------------------+-----------+-----------+-----------+-----------+</FONT>
| TABLE_ID  | COLUMN_ID |              NAME              |   <FONT color=#6959cf>TYPE</FONT>    |TPRECISION |  TSCALE   |   FLAGS   |
+<FONT color=#0000ff>-----------+-----------+--------------------------------+-----------+-----------+-----------+-----------+</FONT>
|          <FONT color=#ff00ff>3</FONT>|          <FONT color=#ff00ff>1</FONT>|col1                            |         <FONT color=#ff00ff>14</FONT>|         <FONT color=#ff00ff>40</FONT>|          <FONT color=#ff00ff>0</FONT>|          <FONT color=#ff00ff>1</FONT>|
|          <FONT color=#ff00ff>3</FONT>|          <FONT color=#ff00ff>2</FONT>|col2                            |         <FONT color=#ff00ff>10</FONT>|          <FONT color=#ff00ff>0</FONT>|          <FONT color=#ff00ff>0</FONT>|          <FONT color=#ff00ff>1</FONT>|
+<FONT color=#0000ff>-----------+-----------+--------------------------------+-----------+-----------+-----------+-----------+</FONT>
<FONT color=#ff00ff>2</FONT> rows returned
testdb&gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable (col1,col2) <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'hello'</FONT>,<FONT color=#ff00ff>50</FONT>);
testdb&gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable (col1,col2) <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'hi'</FONT>,<FONT color=#ff00ff>60</FONT>);
testdb&gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable (col1,col2) <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'bye'</FONT>,<FONT color=#ff00ff>70</FONT>);
testdb&gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable;
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|                  col1                  |   col2    |
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|hello                                   |         <FONT color=#ff00ff>50</FONT>|
|hi                                      |         <FONT color=#ff00ff>60</FONT>|
|bye                                     |         <FONT color=#ff00ff>70</FONT>|
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
<FONT color=#ff00ff>3</FONT> rows returned
testdb&gt; <B><FONT color=#a62828>update</FONT></B> testtable <B><FONT color=#a62828>set</FONT></B> col2=<FONT color=#ff00ff>0</FONT> <FONT color=#6959cf>where</FONT> col1=<FONT color=#ff00ff>'hi'</FONT>;
testdb&gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable;
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|                  col1                  |   col2    |
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|hello                                   |         <FONT color=#ff00ff>50</FONT>|
|hi                                      |          <FONT color=#ff00ff>0</FONT>|
|bye                                     |         <FONT color=#ff00ff>70</FONT>|
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
<FONT color=#ff00ff>3</FONT> rows returned
testdb&gt; <B><FONT color=#a62828>delete</FONT></B> <FONT color=#6959cf>from</FONT> testtable <FONT color=#6959cf>where</FONT> col2=<FONT color=#ff00ff>50</FONT>;
testdb&gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable;
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|                  col1                  |   col2    |
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
|hi                                      |          <FONT color=#ff00ff>0</FONT>|
|bye                                     |         <FONT color=#ff00ff>70</FONT>|
+<FONT color=#0000ff>----------------------------------------+-----------+</FONT>
<FONT color=#ff00ff>2</FONT> rows returned
testdb&gt; <B><FONT color=#a62828>drop</FONT></B> <FONT color=#6959cf>table</FONT> testtable;
testdb&gt; \q
</PRE>
</blockquote>

<a name="sqlrelay"></a>
<span class="heading1">Accessing a Database With SQL Relay</span><br>

<p>Accessing Lago from SQL Relay requires an instance entry in your 
<i>sqlrelay.conf</i> file for the database that you want 
to access.  Here is an example <i>sqlrelay.conf</i> which defines an SQL Relay 
instance called lagotest.  This instance connects to the <i>testdb</i> 
database on the local machine as the user <i>testuser</i> with password 
<i>testpassword</i>.</p>

<PRE>
<FONT color=#0000ff>&lt;?</FONT><B><FONT color=#288a51>xml version=</FONT></B><FONT color=#ff00ff>&quot;1.0&quot;</FONT><FONT color=#0000ff>?&gt;</FONT>
<FONT color=#008a8e>&lt;!</FONT><B><FONT color=#a62828>DOCTYPE</FONT></B> instances <B><FONT color=#a62828>SYSTEM</FONT></B> <FONT color=#ff00ff>&quot;sqlrelay.dtd&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
<FONT color=#008a8e>&lt;instances&gt;</FONT>

        <FONT color=#008a8e>&lt;instance id=</FONT><FONT color=#ff00ff>&quot;lagotest&quot;</FONT><FONT color=#008a8e> port=</FONT><FONT color=#ff00ff>&quot;9000&quot;</FONT><FONT color=#008a8e> socket=</FONT><FONT color=#ff00ff>&quot;/tmp/lagotest.socket&quot;</FONT><FONT color=#008a8e> dbase=</FONT><FONT color=#ff00ff>&quot;lago&quot;</FONT><FONT color=#008a8e> connections=</FONT><FONT color=#ff00ff>&quot;3&quot;</FONT><FONT color=#008a8e> maxconnections=</FONT><FONT color=#ff00ff>&quot;5&quot;</FONT><FONT color=#008a8e> maxqueuelength=</FONT><FONT color=#ff00ff>&quot;0&quot;</FONT><FONT color=#008a8e> growby=</FONT><FONT color=#ff00ff>&quot;1&quot;</FONT><FONT color=#008a8e> ttl=</FONT><FONT color=#ff00ff>&quot;60&quot;</FONT><FONT color=#008a8e> endofsession=</FONT><FONT color=#ff00ff>&quot;commit&quot;</FONT><FONT color=#008a8e> sessiontimeout=</FONT><FONT color=#ff00ff>&quot;600&quot;</FONT><FONT color=#008a8e> runasuser=</FONT><FONT color=#ff00ff>&quot;nobody&quot;</FONT><FONT color=#008a8e> runasgroup=</FONT><FONT color=#ff00ff>&quot;nobody&quot;</FONT><FONT color=#008a8e> cursors=</FONT><FONT color=#ff00ff>&quot;5&quot;</FONT><FONT color=#008a8e> authtier=</FONT><FONT color=#ff00ff>&quot;listener&quot;</FONT><FONT color=#008a8e> handoff=</FONT><FONT color=#ff00ff>&quot;pass&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
                <FONT color=#008a8e>&lt;users&gt;</FONT>
                        <FONT color=#008a8e>&lt;user user=</FONT><FONT color=#ff00ff>&quot;lagotest&quot;</FONT><FONT color=#008a8e> password=</FONT><FONT color=#ff00ff>&quot;lagotest&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/users&gt;</FONT>
                <FONT color=#008a8e>&lt;connections&gt;</FONT>
                        <FONT color=#008a8e>&lt;connection connectionid=</FONT><FONT color=#ff00ff>&quot;lagotest&quot;</FONT><FONT color=#008a8e> string=</FONT><FONT color=#ff00ff>&quot;user=testuser;password=testpassword;db=testdb&quot;</FONT><FONT color=#008a8e> metric=</FONT><FONT color=#ff00ff>&quot;1&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/connections&gt;</FONT>
        <FONT color=#008a8e>&lt;/instance&gt;</FONT>

<FONT color=#008a8e>&lt;/instances&gt;</FONT>
</PRE>

<p>If you want to connect to a database on a remote machine, say on 
<i>testhost</i>, you would need to add <i>host=testhost;</i> to the string 
attribute of the connection tag.</p>

<p>Now you can start up this instance with the following command.</p>

<blockquote>
<b>sqlr-start -id lagotest</b>
</blockquote>

<p>To connect to the instance and run queries, use the following command.</p>

<blockquote>
<b>sqlrsh -id lagotest</b>
</blockquote>

<p>The following command shuts down the SQL Relay instance.</p>

<blockquote>
<b>sqlr-stop lagotest</b>
</blockquote>

</body>

</html>
