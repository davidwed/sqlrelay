<html>

<head>
<title>SQL Relay - Getting Started With Blackray</title>
<link rel="stylesheet" href="../css/styles.css">
</head>

<body>

<span class="heading1">Getting Started With Blackray</span><br>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#creating">Creating a Database</a></li>
<li><a href="#accessing">Accessing a Database</a></li>
<li><a href="#sqlrelay">Accessing a Database With SQL Relay</a></li>
<li><a href="#quirks">Blackray Quirks</a></li>
</ul>

<a name="installation"></a>
<span class="heading1">Installation and Configuration</span><br>

<p>As of version 0.10.0, Blackray provides a database listener that speaks the
PostgreSQL protocol.  As such, SQL Relay can be used to connect to a Blackray
database by configuring it to use a PostgreSQL database connection daemon and
aiming it at the Blackray database.</p>

<p>I have only built Blackray from source on a Fedora Linux system.  The source
code can be downloaded from
<a target="_blank" href="http://www.blackray.org">blackray.org</a>
and pre-built packages are available for a variety of plaforms.</p>

<p>Detailed instructions for downloading, extracting and building the source
as well as installation, configuration, creation of database instances and
accessing the database are available in the
<a target="_blank" href="http://www.blackray.org">Documentation</a> section of
the Blackray site.  They should be sufficient to get you started.</p>

<p>I would recommend running Blackray as a non-root user.  To do so, just
create a blackray user and group and make the blackray installation owned by
that user.  For instance, if you installed it under /opt/blackray, then
use the following command to set the ownership:</p>

<blockquote>
<b>chown -R blackray:blackray /opt/blackray</b>
</blockquote>

<a name="startingatboot"></a>
<span class="heading2">Starting the Database at Boot Time</span><br>

<p>To start Blackray at boot time, you'll need to install a script like the
following to start/stop the database at boot/shutdown time.</p>

<blockquote>
<PRE>
<FONT color=#0000ff>#!/bin/sh</FONT>

<B><FONT color=#a62828>case</FONT></B> &quot;$1&quot; <B><FONT color=#a62828>in</FONT></B>
        start<B><FONT color=#a62828>)</FONT></B>
		su <font color="#6a5acd">-l</font>&nbsp;blackray <font color="#6a5acd">-s</font>&nbsp;/opt/blackray/bin/blackray <font color="#6a5acd">-c</font>&nbsp;/opt/blackray/etc/blackray.conf start
		su <font color="#6a5acd">-l</font>&nbsp;blackray <font color="#6a5acd">-s</font>&nbsp;/opt/blackray/bin/blackray <font color="#6a5acd">-c</font>&nbsp;/opt/blackray/etc/blackray.conf start Default
                <B><FONT color=#a62828>;;</FONT></B>
        stop<B><FONT color=#a62828>)</FONT></B>
		su <font color="#6a5acd">-l</font>&nbsp;blackray <font color="#6a5acd">-s</font>&nbsp;/opt/blackray/bin/blackray <font color="#6a5acd">-c</font>&nbsp;/opt/blackray/etc/blackray.conf stop Default
		su <font color="#6a5acd">-l</font>&nbsp;blackray <font color="#6a5acd">-s</font>&nbsp;/opt/blackray/bin/blackray <font color="#6a5acd">-c</font>&nbsp;/opt/blackray/etc/blackray.conf stop
                <B><FONT color=#a62828>;;</FONT></B>
        *<B><FONT color=#a62828>)</FONT></B>
                <B><FONT color=#a62828>echo</FONT></B><FONT color=#ff00ff> $</FONT><B><FONT color=#a62828>&quot;</FONT></B><FONT color=#ff00ff>Usage: </FONT><FONT color=#a620f7>$0</FONT><FONT color=#ff00ff> {start|stop}</FONT><B><FONT color=#a62828>&quot;</FONT></B>
                <B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>1</FONT>
<B><FONT color=#a62828>esac</FONT></B>

<B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>0</FONT>
</PRE>
</blockquote>

<p>Install this script and run it with the "start" option to start up the
database.  Running it with the "stop" option shuts the database down.  To
access a database, it must be running.</p>

<p>This script starts an instance called Default.  If you want to start/stop a
different instance then you should change that.  If you want to start/stop 
multiple instances then you should add additional lines like the ones that
start and stop the Default instance, substituting Default for the names of your
instances.</p>

<a name="sqlrelay"></a>
<span class="heading1">Accessing a Database With SQL Relay</span><br>

<p>Accessing Blackray from SQL Relay requires an instance entry in your 
<i>sqlrelay.conf</i> file for the instance that you want to access.  Here is an
example <i>sqlrelay.conf</i> which defines an SQL Relay instance called
blackraytest.  This instance connects to the intance of Blackray running on the
remote server <i>testhost</i> on port 5432.</p>

<p>Note the dbase="postgresql" parameter.  SQL Relay is configured to speak the
PostgreSQL protocol and aimed at the Blackray database.  This works because
Blackray supports the PostgreSQL protocol.</p>

<PRE>
<FONT color=#0000ff>&lt;?</FONT><B><FONT color=#288a51>xml version=</FONT></B><FONT color=#ff00ff>&quot;1.0&quot;</FONT><FONT color=#0000ff>?&gt;</FONT>
<FONT color=#008a8e>&lt;!</FONT><B><FONT color=#a62828>DOCTYPE</FONT></B> instances <B><FONT color=#a62828>SYSTEM</FONT></B> <FONT color=#ff00ff>&quot;sqlrelay.dtd&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
<FONT color=#008a8e>&lt;instances&gt;</FONT>

        <FONT color=#008a8e>&lt;instance id=</FONT><FONT color=#ff00ff>&quot;blackraytest&quot;</FONT><FONT color=#008a8e> dbase=</FONT><FONT color=#ff00ff>&quot;postgresql&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
                <FONT color=#008a8e>&lt;users&gt;</FONT>
                        <FONT color=#008a8e>&lt;user user=</FONT><FONT color=#ff00ff>&quot;blackraytest&quot;</FONT><FONT color=#008a8e> password=</FONT><FONT color=#ff00ff>&quot;blackraytest&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/users&gt;</FONT>
                <FONT color=#008a8e>&lt;connections&gt;</FONT>
                        <FONT color=#008a8e>&lt;connection string=</FONT><FONT color=#ff00ff>&quot;host=testhost;port=5432;&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/connections&gt;</FONT>
        <FONT color=#008a8e>&lt;/instance&gt;</FONT>

<FONT color=#008a8e>&lt;/instances&gt;</FONT>
</PRE>

<p>Now you can start up this instance with the following command.</p>

<blockquote>
<b>sqlr-start -id blackraytest</b>
</blockquote>

<p>To connect to the instance and run queries, use the following command.</p>

<blockquote>
<b>sqlrsh -id blackraytest</b>
</blockquote>

<p>The following command shuts down the SQL Relay instance.</p>

<blockquote>
<b>sqlr-stop -id blackraytest</b>
</blockquote>

<a name="quirks"></a>
<span class="heading1">Blackray Quirks</span><br>

<p>The Blackray database is an in-memory database and doesn't support insert,
update or delete queries, or create table queries.  All data must be loaded
using an external program from csv files.  Data can be loaded at any time, and
you can drop tables and alter them, but there is no way to update or delete
rows except to update the csv files and reload them.  Since it's an in-memory
database, no data is stored permanantly unless you explicitly take a snapshot.
</p>

<p>These are a lot of quirks, but the trade-off is performance.</p>

</body>

</html>
