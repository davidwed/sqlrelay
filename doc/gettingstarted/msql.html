<html>

<head>
<title>SQL Relay - Getting Started With mSQL</title>
<link rel="stylesheet" href="../css/styles.css">
</head>

<body>

<span class="heading1">Getting Started With mSQL</span><br>

<ul>
<li><a href="#installation">Installation</a></li>
<ul>
<li><a href="#openserver">SCO OpenServer</a></li>
<li><a href="#configuring">Configuring mSQL</a></li>
<li><a href="#startingatboot">Starting the Database at Boot Time</a></li>
</ul>
<li><a href="#creating">Creating a Database</a></li>
<li><a href="#accessing">Accessing a Database</a></li>
<li><a href="#sqlrelay">Accessing a Database With SQL Relay</a></li>
</ul>

<a name="installation"></a>
<span class="heading1">Installation</span><br>

<p>I've sucessfully installed mSQL on Linux, FreeBSD, NetBSD, OpenBSD, SCO 
OpenServer and Solaris.  I've had to compile it from source on all platforms
except SCO OpenServer.  mSQL is available from the 
<a href="http://www.hughes.com.au">mSQL home page</a>.  It compiles on all
platforms using gcc prior to version 3.3 and yacc or GNU bison prior to version
1.50.  If your platform comes with newer versions of gcc or bison, then you may
have to download and compile older versions and use them to compile msql.</p>

<p>By default, mSQL installs itself in /usr/local/Hughes.  Note that you
should add /usr/local/Hughes/bin to your PATH environment variable.</p>

<p>When compiling from source, you should create a user named msql, assign it a 
password, then compile and install mSQL as that user.</p>

<a name="openserver"></a>
<span class="heading2">SCO OpenServer</span><br>

<p>For SCO OpenServer, mSQL packages are available on the Skunkware CD or from 
the SCO OpenServer support section of 
<a href="http://www.caldera.com">the Caldera website</a>.  SCO OpenServer 
packages are often called VOL's because they come as a set of files named 
VOL.000.000, VOL.000.001, etc.  These VOLS can be installed using the Software 
Manager (custom).  On SCO OpenServer, when the package is installed, it creates
a msql user and sets proper permissions for everything.</p>

<a name="configuring"></a>
<span class="heading2">Configuring mSQL</span><br>

<p>Once mSQL is installed, you should examine it's configuration file
/usr/local/Hughes/msql.conf.  Make sure that the mSQL_User parameter is set to
msql and the Admin_User is set to root.  Also make sure that the directory 
identified by the Inst_Dir paremater and /usr/local/Hughes/msqldb are writable 
by msql.  This should be the case if the msql user installed the software or
if it was installed from a package.</p>

<p>By default, mSQL is configured to allow access from clients on the local 
machine only.  To allow access to remote clients, set the Remote_Access 
parameter to True.  You should use caution when doing this though, mSQL is
<a href="http://www.insecure.org/sploits/msql.authentication.holes.html">exceptionally insecure</a> when remote access is enabled.</p>

<a name="startingatboot"></a>
<span class="heading2">Starting the Database at Boot Time</span><br>

<p>The package distribution of mSQL installs a script which starts the 
database at boot time.  If you compiled from source, you'll need to install a 
script like the following to start the database at boot time.</p>

<blockquote>
<PRE>
<FONT color=#0000ff>#!/bin/sh</FONT>

<B><FONT color=#a62828>case</FONT></B> &quot;$1&quot; <B><FONT color=#a62828>in</FONT></B>
        start<B><FONT color=#a62828>)</FONT></B>
		su <FONT color=#6959cf>-</FONT> msql -c <B><FONT color=#a62828>&quot;</FONT></B><FONT color=#ff00ff>/usr/local/Hughes/bin/msql2d &gt; /dev/null 2&gt; /dev/null &amp;</FONT><B><FONT color=#a62828>&quot;</FONT></B>
                <B><FONT color=#a62828>;;</FONT></B>
        stop<B><FONT color=#a62828>)</FONT></B>
                <B><FONT color=#a62828>kill</FONT></B> <FONT color=#6959cf>`ps </FONT><FONT color=#6959cf>-efa</FONT><FONT color=#6959cf> </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> </FONT><B><FONT color=#a62828>grep</FONT></B><FONT color=#6959cf> msql2d </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> </FONT><B><FONT color=#a62828>grep</FONT></B><FONT color=#6959cf> </FONT><FONT color=#6959cf>-v</FONT><FONT color=#6959cf> </FONT><B><FONT color=#a62828>grep</FONT></B><FONT color=#6959cf> </FONT><B><FONT color=#a62828>|</FONT></B><FONT color=#6959cf> awk </FONT><B><FONT color=#a62828>'</FONT></B><FONT color=#ff00ff>{print $2}</FONT><B><FONT color=#a62828>'</FONT></B><FONT color=#6959cf>`</FONT>
                <B><FONT color=#a62828>;;</FONT></B>
        *<B><FONT color=#a62828>)</FONT></B>
                <B><FONT color=#a62828>echo</FONT></B><FONT color=#ff00ff> $</FONT><B><FONT color=#a62828>&quot;</FONT></B><FONT color=#ff00ff>Usage: </FONT><FONT color=#a620f7>$0</FONT><FONT color=#ff00ff> {start|stop}</FONT><B><FONT color=#a62828>&quot;</FONT></B>
                <B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>1</FONT>
<B><FONT color=#a62828>esac</FONT></B>

<B><FONT color=#a62828>exit</FONT></B> <FONT color=#ff00ff>0</FONT>
</PRE>
</blockquote>

<p>Install this script and run it with the "start" option to start up the
database.  Running it with the "stop" option shuts the database down.  To
access a database, it must be running.</p>

<a name="creating"></a>
<span class="heading1">Creating a Database</span><br>

<p>After installation, mSQL is ready to use but to do any useful work, you'll 
have to create a database.</p>

<p>The following command creates a database named <i>testdb</i>.  This command
must be run as the Admin_User as defined in msql.conf, usually root.</p>

<blockquote>
<b>msqladmin create testdb</b>
</blockquote>

<p>You can log into your new database as follows.</p>

<blockquote>
<b>msql testdb</b>
</blockquote>

<p>Once you're logged in, you can create, drop and modify tables and run
queries in your database.</p>

<p>By default, mSQL is quite insecure.  It allows any user to perform any 
operation they like.  When remote access is enabled, mSQL is 
<a href="http://www.insecure.org/sploits/msql.authentication.holes.html">exceptionally insecure</a>.  To secure an mSQL database, create an Access Control List
file called /usr/local/Hughes/msql.acl with the following contents.</p>

<blockquote>
database=testdb<br>
read=*<br>
write=testuser<br>
access=local<br>
host=*<br>
</blockquote>

<p>This example defines permissions for the <i>testdb</i> database.  It allows
any user to read the database but only the <i>testuser</i> unix user to write 
to it.  Also, access is restricted to clients running on the same machine as 
the database.  Each block of parameters beginning with "database=" controls 
access to that database, so access control can be defined for multiple 
databases from a single /usr/local/Hughes/msql.acl file.</p>

<p>If you want to drop the database, you can do so with the following 
command.  This command must be run as the Admin_User as defined in msql.conf, 
usually root.</p>

<blockquote>
<b>msqladmin drop testdb</b>
</blockquote>

<p>This should be enough to get you started.  To set up more complex 
configurations, consult the mSQL 
<a href="http://www.hughes.com.au/library/msql/manual_20/">online 
documentation</a>.</p>

<a name="accessing"></a>
<span class="heading1">Accessing a Database</span><br>

<p>Accessing a mSQL database using the msql client tool is simple.  For
example, to access a database called <i>testdb</i> on the local machine,
use the following command.</p>

<blockquote>
<b>msql testdb</b>
</blockquote>

<p>If you want to access a database on a remote machine, say on 
<i>testhost</i>, use the -h option as follows.</p>

<blockquote>
<b>msql -htesthost testdb</b>
</blockquote>

<p>Note that in both cases, you'll have to be logged in as a user that is 
allowed to access the database.</p>

<p>Once you're connected to the database, the msql client prompts you to
enter a query.  Queries may be split across multiple lines.  To run a query, 
enter a \g on a line by itself.  To exit, type \q.</p>

<p>A sample msql session follows.</p>

<blockquote>
<PRE>
[testuser@localhost testuser]$ msql testdb

Welcome to the miniSQL monitor.  Type \h for help.


mSQL &gt; <B><FONT color=#a62828>create</FONT></B> <FONT color=#6959cf>table</FONT> testtable (
    -&gt; col1 <B><FONT color=#288a51>char</FONT></B>(<FONT color=#ff00ff>40</FONT>),
    -&gt; col2 <B><FONT color=#288a51>integer</FONT></B>
    -&gt; )
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'hello'</FONT>,<FONT color=#ff00ff>50</FONT>)
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'hi'</FONT>,<FONT color=#ff00ff>60</FONT>)
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>insert</FONT></B> <FONT color=#6959cf>into</FONT> testtable <FONT color=#6959cf>values</FONT> (<FONT color=#ff00ff>'bye'</FONT>,<FONT color=#ff00ff>70</FONT>)
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable
    -&gt; \g

Query OK.  <FONT color=#ff00ff>3</FONT> row(s) modified or retrieved.

 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | col1                                     | col2     |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | hello                                    | <FONT color=#ff00ff>50</FONT>       |
 | hi                                       | <FONT color=#ff00ff>60</FONT>       |
 | bye                                      | <FONT color=#ff00ff>70</FONT>       |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>



mSQL &gt; <B><FONT color=#a62828>update</FONT></B> testtable <B><FONT color=#a62828>set</FONT></B> col2=<FONT color=#ff00ff>0</FONT> <FONT color=#6959cf>where</FONT> col1=<FONT color=#ff00ff>'hi'</FONT> 
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable
    -&gt; \g

Query OK.  <FONT color=#ff00ff>3</FONT> row(s) modified or retrieved.

 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | col1                                     | col2     |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | hello                                    | <FONT color=#ff00ff>50</FONT>       |
 | hi                                       | <FONT color=#ff00ff>0</FONT>        |
 | bye                                      | <FONT color=#ff00ff>70</FONT>       |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>



mSQL &gt; <B><FONT color=#a62828>delete</FONT></B> <FONT color=#6959cf>from</FONT> testtable <FONT color=#6959cf>where</FONT> col2=<FONT color=#ff00ff>50</FONT>
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; <B><FONT color=#a62828>select</FONT></B> * <FONT color=#6959cf>from</FONT> testtable
    -&gt; \g

Query OK.  <FONT color=#ff00ff>2</FONT> row(s) modified or retrieved.

 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | col1                                     | col2     |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>
 | hi                                       | <FONT color=#ff00ff>0</FONT>        |
 | bye                                      | <FONT color=#ff00ff>70</FONT>       |
 +<FONT color=#0000ff>------------------------------------------+----------+</FONT>



mSQL &gt; <B><FONT color=#a62828>drop</FONT></B> <FONT color=#6959cf>table</FONT> testtable
    -&gt; \g

Query OK.  <FONT color=#ff00ff>1</FONT> row(s) modified or retrieved.




mSQL &gt; \q


Bye!


</PRE>
</blockquote>

<a name="sqlrelay"></a>
<span class="heading1">Accessing a Database With SQL Relay</span><br>

<p>Accessing mSQL from SQL Relay requires an instance entry in your 
<i>sqlrelay.conf</i> file for the database that you want 
to access.  Here is an example <i>sqlrelay.conf</i> which defines an SQL Relay 
instance called msqltest.  This instance connects to the <i>testdb</i> 
database on the local machine.  Note how the runasuser and runasgroup attributes
are set to <i>testuser</i>, a user which is allowed to access <i>testdb</i>.</p>

<PRE>
<FONT color=#0000ff>&lt;?</FONT><B><FONT color=#288a51>xml version=</FONT></B><FONT color=#ff00ff>&quot;1.0&quot;</FONT><FONT color=#0000ff>?&gt;</FONT>
<FONT color=#008a8e>&lt;!</FONT><B><FONT color=#a62828>DOCTYPE</FONT></B> instances <B><FONT color=#a62828>SYSTEM</FONT></B> <FONT color=#ff00ff>&quot;sqlrelay.dtd&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
<FONT color=#008a8e>&lt;instances&gt;</FONT>

        <FONT color=#008a8e>&lt;instance id=</FONT><FONT color=#ff00ff>&quot;msqltest&quot;</FONT><FONT color=#008a8e> port=</FONT><FONT color=#ff00ff>&quot;9000&quot;</FONT><FONT color=#008a8e> socket=</FONT><FONT color=#ff00ff>&quot;/tmp/msqltest.socket&quot;</FONT><FONT color=#008a8e> dbase=</FONT><FONT color=#ff00ff>&quot;msql&quot;</FONT><FONT color=#008a8e> connections=</FONT><FONT color=#ff00ff>&quot;3&quot;</FONT><FONT color=#008a8e> maxconnections=</FONT><FONT color=#ff00ff>&quot;5&quot;</FONT><FONT color=#008a8e> maxqueuelength=</FONT><FONT color=#ff00ff>&quot;0&quot;</FONT><FONT color=#008a8e> growby=</FONT><FONT color=#ff00ff>&quot;1&quot;</FONT><FONT color=#008a8e> ttl=</FONT><FONT color=#ff00ff>&quot;60&quot;</FONT><FONT color=#008a8e> endofsession=</FONT><FONT color=#ff00ff>&quot;commit&quot;</FONT><FONT color=#008a8e> sessiontimeout=</FONT><FONT color=#ff00ff>&quot;600&quot;</FONT><FONT color=#008a8e> runasuser=</FONT><FONT color=#ff00ff>&quot;testuser&quot;</FONT><FONT color=#008a8e> runasgroup=</FONT><FONT color=#ff00ff>&quot;testuser&quot;</FONT><FONT color=#008a8e> cursors=</FONT><FONT color=#ff00ff>&quot;5&quot;</FONT><FONT color=#008a8e> authtier=</FONT><FONT color=#ff00ff>&quot;listener&quot;</FONT><FONT color=#008a8e> handoff=</FONT><FONT color=#ff00ff>&quot;pass&quot;</FONT><FONT color=#008a8e>&gt;</FONT>
                <FONT color=#008a8e>&lt;users&gt;</FONT>
                        <FONT color=#008a8e>&lt;user user=</FONT><FONT color=#ff00ff>&quot;msqltest&quot;</FONT><FONT color=#008a8e> password=</FONT><FONT color=#ff00ff>&quot;msqltest&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/users&gt;</FONT>
                <FONT color=#008a8e>&lt;connections&gt;</FONT>
                        <FONT color=#008a8e>&lt;connection connectionid=</FONT><FONT color=#ff00ff>&quot;msqltest&quot;</FONT><FONT color=#008a8e> string=</FONT><FONT color=#ff00ff>&quot;db=testdb&quot;</FONT><FONT color=#008a8e> metric=</FONT><FONT color=#ff00ff>&quot;1&quot;</FONT><FONT color=#008a8e>/&gt;</FONT>
                <FONT color=#008a8e>&lt;/connections&gt;</FONT>
        <FONT color=#008a8e>&lt;/instance&gt;</FONT>

<FONT color=#008a8e>&lt;/instances&gt;</FONT>
</PRE>

<p>If you want to connect to a database on a remote machine, say on 
<i>testhost</i>, you would need to add <i>host=testhost;</i> to the string 
attribute of the connection tag.</p>

<p>Now you can start up this instance with the following command.</p>

<blockquote>
<b>sqlr-start -id msqltest</b>
</blockquote>

<p>To connect to the instance and run queries, use the following command.</p>

<blockquote>
<b>sqlrsh -id msqltest</b>
</blockquote>

<p>The following command shuts down the SQL Relay instance.</p>

<blockquote>
<b>sqlr-stop msqltest</b>
</blockquote>

</body>

</html>
