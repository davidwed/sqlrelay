<h1>Ubuntu 16.04 - JetBrains DataGrip + SQL Relay</h1>

<p>This how-to walks through:</p>

<ul>
  <li>Installing JetBrains DataGrip on an Ubuntu 16.04 system</li>
  <li>Using DataGrip to access a database via an SQL Relay server, installed on another system</li>
</ul>

<p>DataGrip can access any data source for which a JDBC driver exists.  SQL Relay doesn't provide a proper JDBC driver, but does provide an ODBC driver.  So, the JDBC-ODBC bridge provided by Java 1.7 can be used to access SQL Relay.</p>

<p>The how-to assumes that two systems have been set up and configured as follows:</p>

<p><b>DataGrip/SQL Relay client</b></p>

<ul>
  <li>Ubuntu 16.04 Desktop operating system</li>
  <li><i>apt upgrade</i> was run post-install</li>
  <li>A user with sudo privileges has desktop access to the system</li>
</ul>

<p>( See the how-to <a href="ubuntu1604-sqlrclient.html">Ubuntu 16.04 - Basic SQL Relay Client</a> for information on configuring a system like this. )</p>

<p><b>SQL Relay server</b></p>

<ul>
  <li>Any operating system that supports SQL Relay server, accessible as:</li>
  <ul>
    <li>Hostname: <b>sqlrserver</b></li>
    <li>Port: 9000</li>
    <li>Username: <b>sqlruser</b></li>
    <li>Password: <b>sqlrpassword</b></li>
  </ul>

</ul>

<p>( See the how-to <a href="ubuntu1604-sqlrserver-oracle12c.html">Ubuntu 16.04 - SQL Relay Server + Oracle 12c</a> for information on configuring a system like this. )</p>

<h3>Install Java SE 1.7</h3>

<p>On the DataGrip/SQL Relay client system, download Java JDK 1.7 as follows.</p>

<ul>
  <li>Navigate to <a target="_blank" href="https://oracle.com">the Oracle website</a>.</li>
  <li>Mouse-over the <i>Sign In</i> link at the top right of the page.</li>
  <li>If you don't already have an account, click <i>Create an account</i> and follow the instructions.</li>
  <li>If you have an account, click the <i>Sign In</i> box and enter your Username and Password.</li>
  <li>Navigate to <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html">Java SE 7 Archive Downloads</a>.</li>
  <li>Click the radio box next to <i>Accept License Agreement</i>.</li>
  <li>Scroll down to the section labelled <i>Java SE Development Kit 7u80</i> and download the following tar.gz file from beneath that section:</li>
  <ul>
    <li>jdk-7u80-linux-x64.tar.gz</li>
  </ul>

</ul>

<p>Install the contents of the tar.gz file as follows:</p>

<pre>tar xfz jdk-7u80-linux-x64.tar.gz
sudo mv jdk1.7.0_80 /opt
</pre>

<br/><h3>Install DataGrip</h3>

<p>Download DataGrip as follows:</p>

<ul>
  <li>Navigate to <a target="_blank" href="https://www.jetbrains.com/datagrip/download/#section=linux">Download DataGrip</a>.</li>
  <li>Click the Download button.</li>
  <li>Wait a few seconds for the download to start.</li>
</ul>

<p>Install DataGrip as follows:</p>

<pre>tar xfz datagrip-*.tar.gz
sudo mv DatGrip-* /opt
</pre>

<p>Create the script /usr/local/bin/datagrip.sh with the following contents:</p>

<pre>#!/bin/sh

export JAVA_HOME=/opt/jdk1.7.0_80
export LD_LIBRARY_PATH=/opt/jdk1.7.0_80/jre/lib/amd64
export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libodbc.so

cd /opt/DataGrip-*/bin
./datagrip.sh
</pre>

<p>The JAVA_HOME variable indicates which JVM to use.  In this case, we must use the Java 1.7 JVM that we installed earlier as opposed to any system JVM.</p>

<p>The LD_LIBRARY_PATH variable includes the location of the libJdbcOdbc.so library (the native component of the JDBC-ODBC bridge) and various libraries that it depends on.</p>

<p>The LD_PRELOAD variable makes sure that the ODBC library is loaded, as libJdbcOdbc.so requires it, but isn't actually linked against it, for some reason.</p>

<p>Give the script execute permissions as follows.</p>

<pre>sudo chmod 755 /usr/local/bin/datagrip.sh
</pre>

<h3>Configure ODBC</h3>

<p>Append the following to /etc/odbcinst.ini</p>

<pre>[SQLRelay]
Description=ODBC for SQL Relay
Setup=/usr/local/firstworks/lib/libsqlrodbc.so
Driver=/usr/local/firstworks/lib/libsqlrodbc.so
Setup64=/usr/local/firstworks/lib/libsqlrodbc.so
Driver64=/usr/local/firstworks/lib/libsqlrodbc.so
UsageCount=1
</pre>

<p>Append the following to /etc/odbc/ini</p>

<pre>[sqlrserver]
Driver=SQLRelay
Server=sqlrserver
Port=9000
User=sqlruser
Password=sqlrpassword
</pre>

<br/><h3>Run DataGrip for the First Time</h3>

<p>The first time you run DataGrip it prompts you for various initial configuration options.</p>

<p>Run the datagrip.sh script you created earlier as follows.</p>

<pre>datagrip.sh
</pre>

<ul>
  <li>On the Complete Installation dialog:</li>
  <ul>
    <li>Leave Do not import settings selected</li>
    <li>Click Ok</li>
  </ul>

  <li>On the DataGrip Privacy Policy Agreement dialog:</li>
  <ul>
    <li>Click Accept</li>
  </ul>

  <li>On the DataGrip License Activation dialog:</li>
  <ul>
    <li>Click Evaluate for free</li>
    <li>Click Evaluate</li>
  </ul>

  <li>On the License Agreement for DataGrip... dialog:</li>
  <ul>
    <li>Click Accept</li>
  </ul>

  <li>On the Customize DataGrip dialog:</li>
  <ul>
    <li>Click Skip Remaining and Set Defaults</li>
  </ul>

</ul>

<p>DataGrip should now be running and present you with its main page.</p>

<h3>Add an ODBC Driver Profile</h3>

<p>DataGrip comes with JDBC driver profiles for Oracle, MySQL, PostgreSQL, and many other databases, but it doesn't come with an ODBC driver profile.</p>

<p>To add an ODBC driver profile:</p>

<ul>
  <li>Click File -> Data Sources...</li>
</ul>

<p>This should pop up a Data Sources and Drivers dialog.</p>

<ul>
  <li>Click the + in the upper left hand corner and select Driver</li>
</ul>

<p>This should add a new entry to the Drivers list named Database Driver and display a panel with various Driver-related settings to the right of the list.</p>

<ul>
  <li>Replace the Name of Database Driver with ODBC.</li>
  <li>Click the + to the right of the box under Additional files</li>
  <li>In the Select Database Driver Files dialog:</li>
  <ul>
    <li>Navigate to /opt/jdk1.7.0_80/jre/lib</li>
    <li>Select rt.jar</li>
    <li>Click OK</li>
  </ul>

  <li>Click the Class pulldown and select sun.jdbc.odbc.JdbcOdbcDriver</li>
  <li>Click OK</li>
</ul>

<h3>Add an ODBC Database Connection</h3>

<p>To configure an ODBC connection to SQL Relay:</p>

<ul>
  <li>Mouse-over the icon in the lower left corner of the DataGrip window.</li>
  <li>Select Database</li>
</ul>

<p>This should pop up a Database window.</p>

<ul>
  <li>Click the + in the upper right of this window</li>
  <li>Select Data Source -> ODBC</li>
</ul>

<p>This should pop up the Data Sources and Drivers dialog.  There should be a Project Data Sources list at the top, with an entry named ODBC -.  There should be a with various Data Source-related settings to the right of the list.</p>

<ul>
  <li>Set User to sqlruser</li>
  <li>Set Password to sqlrpassword</li>
  <li>Set URL to jdbc:odbc:sqlrserver</li>
  <li>Click OK</li>
</ul>

<p>This should close the Data Sources and Drivers dialog and bring up a console window labeled ODBC - jdbc:odbc:sqlrserver.</p>

<ul>
  <li>If you get a Choose password for new keyring dialog, just click Cancel.</li>
  <li>If you get an error indicating that the SQL dialect isn't set, then it is safe to ignore.</li>
</ul>

<h3>Verify Connectivity to the SQL Relay Server</h3>

<p>In the jdbc:odbc:sqlrserver console, enter a query like the following:</p>

<pre>select 'hello world' from dual
</pre>

<p>And click the green arrow in the upper left hand corner of the console window.</p>

<p>It should display results in a new window below, like the following:</p>

<pre>   'HELLOWORLD'
1  hello world
</pre>

<p>At this point, you should be able to run any query you like, and generally use DataGrip as you would with any other database.</p>

<h3>Uninstallation</h3>

<p>If, for some reason, you need to completely uninstall DataGrip and its dependencies, then run the following commands:</p>

<pre>sudo rm -rf /opt/DataGrip-* /opt/jdk1.7.0_80 /usr/local/bin/datagrip.sh
</pre>

Then run the uninstallation procedure for SQL Relay and Rudiments as described in <a href="ubuntu1604-sqlrclient.html">Ubuntu 16.04 - Basic SQL Relay Client</a>.
