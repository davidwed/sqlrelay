<html>
<head>
<title>SQL Relay - Extension Modules - Logger</title>
<link href="../css/styles.css" rel="stylesheet">
</head>
<body>

<span class="heading1">Logger Modules</span><br><br>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#available">Available Modules</a></li>
<li><a href="#custom">Custom Modules</a></li>
</ul>

<hr>

<br><a name="introduction"></a>
<span class="heading2">Introduction</span><br>

<p>Logger modules allow the SQL Relay server programs to log various bits of information as they run.  A section of the sqlrelay.conf file indicates which modules to load and what parameters to use when logging.</p>

<p>For example, to use the <i>debug</i> module, which logs detailed information for debugging purposes, you would include a section in the sqlrelay.conf file like:</p>

<blockquote>
<font face="monospace">
<font color="#008b8b">&lt;</font><font color="#008b8b">instance</font><font color="#008b8b">&nbsp;...&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">&lt;</font><font color="#008b8b">loggers</font><font color="#008b8b">&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">&lt;</font><font color="#008b8b">logger</font><font color="#008b8b">&nbsp;</font><font color="#2e8b57"><b>module</b></font>=<font color="#ff00ff">&quot;debug&quot;</font><font color="#008b8b">&nbsp;</font><font color="#2e8b57"><b>listener</b></font>=<font color="#ff00ff">&quot;yes&quot;</font><font color="#008b8b">&nbsp;</font><font color="#2e8b57"><b>connection</b></font>=<font color="#ff00ff">&quot;yes&quot;</font><font color="#008b8b">/&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008b8b">&lt;/logger&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
<font color="#008b8b">&lt;/intstance&gt;</font><br>
</font>
</blockquote>

<p>The <i>module</i> attribute specifies which module to load.  The <i>listener</i> and <i>connection</i> attributes are parameters for the module.  Different modules may have different parameters, or may have no parameters.  In this case, listener="yes" tells the module to log debug info for the sqlr-listener processes and connection="yes" tells the module to log debug info for the sqlr-connection processes.</p>

<p>Multiple log modules may be loaded by specifying multiple logger tags.</p>

<p>Internally, at startup the SQL Relay server processes create instances of the specified logger modules and initialize them.  Then, as they run, the call the logger modules' "run" method, passing in an event type, log level and log message.  The modules then react to the different events, log levels and messages in a module-specific manner.  The "debug" logger module, for example logs every event type at every log level, while the "slowqueries" logger module only logs queries and ignores all other event types.</p>

<br><a name="available"></a>
<span class="heading2">Available Modules</span><br>

<p>Currently, the following standard logger modules are available:</p>

<b>
<ul>
<li>debug</li>
<li>slowqueries</li>
</ul>
</b>

<p>Additional standard modules will be available in the future.</p>

<p>Custom modules that log very specific information in very specific formats are also available in the general SQL Relay distribution but they are not intended for general use.</p>

<span class="heading3">debug</span><br>

<p>The <b>debug</b> module logs a great deal of information to about the internal operation of the SQL Relay server to log files in the "debug directory", usually /usr/local/firstworks/var/sqlrelay/debug.  It creates files named sqlr-listener."pid" and sqlr-connection."pid" where "pid" is replaced with the process id of the process that is being logged.  As new processes are forked, new files are created with debug information about those processes.</p>

<p>This module takes two parameters: <b>listener</b> and <b>connection</b>.  The <b>listener</b> parameter may be set to "no" to disable logging of the sqlr-listener processes.  The <b>connection</b> parameter may be set to "no" to disable logging of the sqlr-connection processes.  Logging is enabled if either parameter is omitted or set to any other value.</p>

<p>The general format is:</p>

<blockquote><code>
mm/dd/yyyy hh:mm:ss TZ processname [pid] : info
</code></blockquote>

<p>Sample log for main listener process: <a href="sqlr-listener.1869.html">sqlr-listener.1869</a><br>
Sample log for child listener process: <a href="sqlr-listener.1886.html">sqlr-listener.1886</a><br>
Sample log for connecton process: <a href="sqlr-connection.1871.html">sqlr-connection.1871</a></p>

<span class="heading3">slowqueries</span><br>

<p>The <b>slowqueries</b> module logs queries that take longer to run than a specified threshold to log files in the "log directory", usually /usr/local/firstworks/var/sqlrelay/log.  It creates files named sqlr-connection-"id"-querylog."pid" for each sqlr-connection process where "id" is replaced with the id of the instance from the sqlrelay.conf file and "pid" is replaced with the process id.</p>

<p>This module takes two parameters: <b>sec</b> and <b>usec</b>.  Queries that take longer than <b>sec</b> seconds and <b>usec</b> microseconds will be logged.  Both parameters default to 0 and omitting them causes all queries to be logged.</p>

<p>The general format is:</p>

<blockquote><pre>
query:
select 1 from dual
time: 0.000000
</pre></blockquote>

<p>Sample log: <a href="sqlr-connection-oracletest-querylog.2899.html">sqlr-connection-oracletest-querylog.2899</a></p>

</body>
</html>
